function $_global_spgantt(){if("undefined"==typeof g_all_modules)g_all_modules={};g_all_modules["spgantt.js"]={version:{rmj:16,rmm:0,rup:7723,rpr:1204}};typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkBegin_spgantt.js");!Type.isNamespace("SPG")&&Type.registerNamespace("SPG");SPG.TextMaxLengthPropertyType=function(a){a:;this.ID="SPTextMaxLength";this.BeginValidateNormalizeConvert=function(g,e,b,f,d){a:;b=b!=null&&b.length==0?null:b;b=SP.JsGrid.SPUserValueOnPasteFixup(b);var c=a[e];if(b!=null&&c!=null&&c!=0)b=b.substr(0,c);d({isValid:true,dataValue:b,normalizedLocValue:b})};this.GetMaxLength=function(b){a:;return a[b]};this.toString=function(){a:;return this.ID}};SPG.DatePropertyType=function(){a:;this.ID="SPDateTime";this.BeginValidateNormalizeConvert=function(d,e,a,c,b){a:;a=SP.JsGrid.SPUserValueOnPasteFixup(a);b({isValid:true,dataValue:SP.JsGrid.EmptyValue,normalizedLocValue:a.toUpperCase()})}};SPG.PercentCompletePropertyType=function(){a:;this.ID="SPPercentComplete";this.BeginValidateNormalizeConvert=function(d,e,a,c,b){a:;a=SP.JsGrid.SPUserValueOnPasteFixup(a);b({isValid:true,dataValue:null,normalizedLocValue:a})}};SPG.EditPropertyType=function(){a:;this.ID="SPEdit";this.GetImageSource=function(b,a){a:;return a&SPG.Permissions.editListItems?"/_layouts/15/images/edititem.gif":null};this.DataToLocalized=function(a){a:;return a&SPG.Permissions.editListItems?SP.Res.editColEditable:SP.Res.editColReadOnly}};SPG.UserPropertyType=function(c){a:;this.ID="SPUser";this.BeginValidateNormalizeConvert=function(f,g,b,c,d){a:;SP.JsGrid.hasPasteStarted=false;var a=c?this.LocalizedToData(b):b,e=a!=null&&a!=SP.JsGrid.EmptyValue&&a!=SP.JsGrid.InvalidValue?Boolean(a.display!=a.email)||Boolean(a.length>1):false;d({isValid:true,dataValue:a,normalizedLocValue:c&&!e?b:this.DataToLocalized(a)})};this.GetPeoplePickerSettings=function(a){a:;return c.customFieldInfo[a]};this.SetPeoplePickerDefaultSettings=function(a){a:;c.customFieldInfo[a]="User,SecGroup,SPGroup;#0;#false"};this.LocalizedToData=function(a){a:;return d(a)};this.DataToLocalized=function(a){a:;if(a==null)return null;var b=null;if(typeof a.length=="undefined")b=a.display;else{for(var d=[],c=0;c<a.length;c++)d.push(a[c].display);b=URI.convertMultiColumnValueToString(d,SP.JsGrid.multiValSeparator,false)}return b};this.IsDataEqual=function(a,b){a:;if(a==null||b==null)return a==b;function e(a,b){a:;return a.display==b.display&&a.email==b.email}var d=false;if("length"in a&&"length"in b)if(a.length!=b.length)return false;else for(var c=0;c<a.length;c++){d=e(a[c],b[c]);if(!d)break}else return e(a,b);return d};this.GetCopyValue=function(c,a,b){a:;SP.JsGrid.lastCopiedValueType_SPUser=true;return a==null?b:e(a)};this.SetSeparator=function(a){a:;if(a!=null)SP.JsGrid.multiValSeparator=a.length==1?a+" ":a};function b(c){a:;var a=c.split(SP.JsGrid.serializedFieldSeparator),b={display:a[0],email:typeof a[1]!="undefined"?a[1]:a[0]};return b}function d(c){if(c==SP.JsGrid.EmptyValue||c=="")return null;var a=c.split(SP.JsGrid.multiValSeparator);if(a.length==1)return b(a[0]);else{for(var e=[],d=0;d<a.length;d++)e.push(b(a[d]));return e}}function a(a){a:;return typeof a.display=="undefined"||typeof a.email=="undefined"?String.format("{0}{1}{2}",a.get_lookupValue(),SP.JsGrid.serializedFieldSeparator,a.get_email()):String.format("{0}{1}{2}",a.display,SP.JsGrid.serializedFieldSeparator,a.email)}function e(b){a:;if(b==null)return null;var d=[];if("email"in b)d.push(a(b));else if("length"in b)for(var c=0;c<b.length;c++)if(b[c].data!=null)d.push(a(b[c].data));else d.push(a(b[c]));return URI.convertMultiColumnValueToString(d,SP.JsGrid.multiValSeparator,false)}};SPG.LookupPropertyType=function(e,b){a:;var a;this.ID=e+"_Lookup";this.GetItems=function(b){a:;c(d,e);function d(){a:;for(var d=[],c=0;c<a.length;c++)d.push(SP.JsGrid.Property.MakeProperty(a[c].id,a[c].locValue,true,true,this));b(d)}function e(){a:;b(null)}};this.InvalidateCache=function(){a:;a=null};this.BeginValidateNormalizeConvert=function(i,j,d,e,f,h){a:;c(g,h);function g(){a:;if(!b.required&&e&&d==""||!e&&d==null){f({isValid:true,dataValue:[],normalizedLocValue:""});return}var c=SP.Internal.JS.FindInArray(a,e?function(a){a:;return d==a.locValue}:function(a){a:;return d==a.id});f(c==null?{isValid:false}:{isValid:true,dataValue:a[c].id,normalizedLocValue:a[c].locValue})}};function c(c,e){a:;if(a==null)d(b.webUrl,b.listId,b.field,function(b){a:;if(b==null)e();else{a=b;c()}});else c()}function d(k,j,a,e){a:;var i=['<View Scope="RecursiveAll">',"<ViewFields>",'<FieldRef Name="ID"/>','<FieldRef Name="'+escape(a)+'"/>',"</ViewFields>",'<Query><OrderBy><FieldRef Name="'+escape(a)+'"/></OrderBy></Query>',"</View>"].join(""),b=new SP.ClientContext(k),l=b.get_web().get_lists().getById(j),f=new SP.CamlQuery;f.set_viewXml(i);var c=l.getItems(f),d=c.retrieveItems();d.retrieve("ID");d.retrieveObject("FieldValuesAsText").retrieve(a);b.add_requestSucceeded(h);b.add_requestFailed(g);b.executeQueryAsync();function h(){a:;for(var g=[],i=c.get_count(),b=0;b<i;b++){var f=c.itemAt(b),h=f.get_fieldValues(),d=f.get_fieldValuesAsText().get_fieldValues();if(IsStrNullOrEmpty(d[a]))continue;g.push({id:h.ID,locValue:d[a]})}e(g)}function g(){a:;e(null)}}};(function(){a:;SPG.MultilineTextPropertyType=function(){a:;this.ID="SPMultilineText";this.BeginValidateNormalizeConvert=function(d,e,a,c,b){a:;a=a!=null&&a.length==0?null:a.replace(/<br>/g,"\n");a=SP.JsGrid.SPUserValueOnPasteFixup(a);b({isValid:true,dataValue:a,normalizedLocValue:a})};this.LocalizedValueToCSRValue=function(a){a:;return a==null?null:STSHtmlEncode(a.replace(/\n/g,"<br>"))}};SPG.EnhancedRichTextPropertyType=function(){a:;this.ID="SPEnhancedRichText";this.BeginValidateNormalizeConvert=function(d,e,a,c,b){a:;a=a!=null&&a.length==0?null:a;a=SP.JsGrid.SPUserValueOnPasteFixup(a);b({isValid:true,dataValue:a,normalizedLocValue:a})};this.LocalizedValueToCSRValue=function(a){a:;return a}}})();SPG.BarStyle={Summary:0,Standard:1,Milestone:2,PctComplete:3};SPG.Permissions={addListItems:2,editListItems:4,deleteListItems:8};g_ganttControlInstances={};OnJsGridIframeLoad=function(a){a:;g_ganttControlInstances[a].OnAutoFilterReturn()};SPG.MultilinePlainTextEditControl=function(c){a:;this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.LocalizedOnly;this.SupportedReadMode=SP.JsGrid.EditActorReadType.LocalizedOnly;var k=this,m="jsgrid_multilineeditbox",a,l=c.parentNode,b,e;function f(){a:;var d=b.cellWidth-12,c=b.cellHeight-6;a.style.width=d+"px";a.style.height=c+"px"}function i(a){a:;a.stopPropagation()}function j(a){a:;if(a.keyCode==13)return;typeof c.OnKeyDown=="function"&&c.OnKeyDown(a)}function h(b){a:;if(b){$addHandler(a,"focus",c.OnActivateActor);$addHandler(a,"blur",c.OnDeactivateActor);$addHandler(a,"keydown",j);$addHandler(a,"mousedown",i)}else{$removeHandler(a,"focus",c.OnActivateActor);$removeHandler(a,"blur",c.OnDeactivateActor);$removeHandler(a,"keydown",j);$removeHandler(a,"mousedown",i)}}function d(){a:;var c=b.field.key;if(b.record.fieldRawDataMap.csrInfo!=null){var a=b.record.fieldRawDataMap.csrInfo[c];if(a!=null){a=STSHtmlDecode(a);a=a.replace(/<br>/g,"\n")}return a}return null}function g(c){a:;var a=c;if(c!=null){a=STSHtmlEncode(a);a=a.replace(/\n/g,"<br>")}var d=b.field.key;if(b.record.fieldRawDataMap.csrInfo==null)b.record.fieldRawDataMap.csrInfo={};b.record.fieldRawDataMap.csrInfo[d]=a;b.SetCurrentValue({localized:c})}this.Dispose=function(){a:;$clearHandlers(a)};this.Focus=function(b){a:;try{a.focus();if(b==null)a.value=a.value;else if(b.type=="mousedown"||b.type=="gridapi"||b.type=="keydown"&&b.keyCode==SP.Internal.Key.F2)c();else if(SP.JsGrid.Utility.IsChar(b)){a.value=String.fromCharCode(b.charCode);g(a.value)}}catch(e){}function c(){a:;var b=d();a.value=b==null||b==SP.JsGrid.EmptyValue?"":b}};this.BindToCell=function(e){a:;b=e;f();if(b.field.textDirection!=SP.JsGrid.TextDirection.Default)a.style.direction=b.field.textDirection==SP.JsGrid.TextDirection.RightToLeft?"rtl":"ltr";var c=d();a.value=c==null||c==SP.JsGrid.EmptyValue?"":c};this.OnBeginEdit=function(c){b.Show(a);e=true;h(true);if(c.type=="mousedown")setTimeout(function(){a:;k.Focus(c)},0);else k.Focus(c)};this.Unbind=function(){a:;a.value=""};this.OnEndEdit=function(){a:;h(false);var c=d();c=c==null||c==SP.JsGrid.EmptyValue?"":c;a.value!=c&&g(a.value);b.Hide(a);e=false};this.OnCellMove=function(){a:;f();e&&b.Show(a)};this.OnValueChanged=function(b){a:;a.value=b.localized==null||b.localized==SP.JsGrid.EmptyValue?"":b.localized};a=document.createElement("textarea");a.id=m;a.className="jsgrid-control-multiline";a.style.cssText="visibility:hidden;position:absolute;top:0px;left:0px;";a.tabIndex=-1;a.style.direction=c.RTL.ltr;l.appendChild(a)};SPG.EnhancedRichTextEditControl=function(f,v){a:;this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.LocalizedOnly;this.SupportedReadMode=SP.JsGrid.EditActorReadType.LocalizedOnly;var u=this,g="jsgrid_richtexteditbox",y=f.parentNode,c,m,x=84;function n(){a:;var e=c.cellWidth-6+"px",b=c.cellHeight-6+"px";d.style.minWidth=e;d.style.minHeight=b;a.style.minWidth=e;a.style.minHeight=b}function r(a){a:;a.stopPropagation()}function t(a){a:;if(a.keyCode==13)return;typeof f.OnKeyDown=="function"&&f.OnKeyDown(a)}function p(b){a:;if(b){$addHandler(a,"focus",f.OnActivateActor);$addHandler(a,"keydown",t);$addHandler(a,"mousedown",r)}else{$removeHandler(a,"focus",f.OnActivateActor);$removeHandler(a,"keydown",t);$removeHandler(a,"mousedown",r)}}function j(){a:;var a=c.field.key;return c.record.fieldRawDataMap.csrInfo!=null?c.record.fieldRawDataMap.csrInfo[a]:null}function o(a){a:;var b=c.field.key;if(c.record.fieldRawDataMap.csrInfo==null)c.record.fieldRawDataMap.csrInfo={};c.record.fieldRawDataMap.csrInfo[b]=a;c.SetCurrentValue({localized:a})}this.Dispose=function(){a:;$clearHandlers(a)};this.Focus=function(c){a:;try{a.focus();if(c==null){RTE.Cursor.get_range().moveToEndOfNode(a);RTE.Cursor.update()}else if(c.type=="mousedown"||c.type=="gridapi"||c.type=="keydown"&&c.keyCode==SP.Internal.Key.F2)d();else if(SP.JsGrid.Utility.IsChar(c)){a.innerHTML="";b.value=String.fromCharCode(c.charCode);o(b.value);var e=document.createTextNode(b.value);RTE.Cursor.get_range().moveToEndOfNode(a);RTE.Cursor.get_range().insertNode(e);RTE.Cursor.get_range().moveToEndOfNode(a);RTE.Cursor.update()}}catch(f){}function d(){a:;var c=j();b.value=c==null||c==SP.JsGrid.EmptyValue?"":c;a.innerHTML=b.value;RTE.Cursor.get_range().moveToEndOfNode(a);RTE.Cursor.update()}};this.BindToCell=function(e){a:;c=e;w();n();if(c.field.textDirection!=SP.JsGrid.TextDirection.Default)a.style.direction=c.field.textDirection==SP.JsGrid.TextDirection.RightToLeft?"rtl":"ltr";var d=j();b.value=d==null||d==SP.JsGrid.EmptyValue?"":d;a.innerHTML=b.value};this.OnBeginEdit=function(a){c.Show(d);m=true;p(true);if(a.type=="mousedown")setTimeout(function(){a:;u.Focus(a)},0);else u.Focus(a)};this.Unbind=function(){a:;b.value="";a.innerHTML=""};this.OnEndEdit=function(){a:;p(false);var a=j();a=a==null||a==SP.JsGrid.EmptyValue?"":a;RTE.RichTextEditor.transferContentsToInputField(i,false);b.value!=a&&o(b.value);c.Hide(d);d.style.top="-10000px";d.style.left="-10000px";m=false};this.OnCellMove=function(){a:;n();m&&c.Show(d)};this.OnValueChanged=function(c){a:;b.value=c.localized==null||c.localized==SP.JsGrid.EmptyValue?"":c.localized;a.innerHTML=b.value};function w(){a:;if(a!=null){e.removeChild(a);a=null}a=document.createElement("div");a.className="ms-rtestate-write ms-rteflags-0";a.id=i;a.style.minHeight=x+"px";a.setAttribute("aria-labelledby",g+"_label");a.setAttribute("contentEditable","true");a.style.direction=f.RTL.ltr;a.style.paddingLeft="3px";a.style.paddingRight="3px";e.appendChild(a);if(a!=null)a.InputFieldId=s;if(b!=null&&b.value=="")b.value=a.innerHTML;RTE.Canvas.fixRegion(i,false)}var d=document.createElement("span");d.id=g;d.className="jsgrid-control-rte";d.style.cssText="visibility:hidden;position:absolute;top:-10000px;left:-10000px;";d.tabIndex=-1;var e=document.createElement("div");e.className="ms-rtestate-field ms-rtefield ms-shadow";e.style.minWidth="0px";e.id=g+"_topDiv";var l=document.createElement("div");l.id=g+"_label";l.style.display="none";var i=g="_rte"+(v?v:""),a=null,q=document.createElement("div");q.style.clear="both";e.appendChild(l);e.appendChild(q);d.appendChild(e);var k=document.createElement("span"),s=g+"_saveInput",b=document.createElement("input");b.id=s;b.type="hidden";var h=document.createElement("input");h.id="ms-rtefocuselementid";h.name="ms-rtefocuselementid";h.type="hidden";k.appendChild(b);k.appendChild(h);d.appendChild(k);y.appendChild(d)};SPG.GetEditBoxEditControl=function(b,d){var a=d?SP.JsGrid.EditControl.GetHyperlinkEditControl(b):new SP.JsGrid.EditControl.EditBoxEditControl(b),c=a.BindToCell;a.BindToCell=function(a){a:;c.call(this,a);var b=this.GetInputElement();typeof a.propType.GetMaxLength=="function"&&b.setAttribute("MaxLength",a.propType.GetMaxLength(a.fieldKey))};var e=a.Unbind;a.Unbind=function(){a:;e.call(this);var a=this.GetInputElement();a.setAttribute("MaxLength",null)};return a};SPG.GetPeoplePickerEditControl=function(c){a:;var a=new SP.JsGrid.EditControl.PeoplePickerEditControl(c),b=a.BindToCell;a.BindToCell=function(a){a:;b.call(this,a)};var d=a.Unbind;a.Unbind=function(){a:;d.call(this)};return a};SP.WebMethod=function(b,a){this.name=b;this.fnGenerateArgs=a};SP.HierarchyTasksWebManager=function(b){a:;this.RegisterMethod=function(b){a:;this[b.name]=function(f,e,d,c){a:;a(b,f,e,d,c)};return b};function a(f,h,d,c){a:;var a=new SP.PageRequest;a.set_url(b);a.set_expectedContentType("application/json");a.add_succeeded(e);a.add_failed(g);a.post("cmd="+f.name+"&args="+Sys.Serialization.JavaScriptSerializer.serialize(h));function e(f,e){a:;var b=e.get_executor().get_responseData(),a=null;ULS.AssertJS(ULSCat.msoulscat_WSS_SPGantt,b!=null&&b!="","Null or empty parameter to deserialize");try{a=SP_JSONParse(b)}catch(g){ULS.SendExceptionJS(ULSCat.msoulscat_WSS_SPGantt,g);return}if(a.correlationId!=null){addNotification(SP.Res.unknownError+": "+a.error+" "+a.correlationId,true);c!=null&&c()}else d(a)}function g(){a:;addNotification(SP.Res.serverCommError,false);c!=null&&c()}}};SP.GanttControl=function(){a:;var h=this,a,x,lc,U=null,b,N,e,o,hc,gc,F,pc,r,z,O,g,p,t,d=false,j=false,n={},l={},i={},v={},Q=new SP.Utilities.Set,s={},c={},f,E,A,S,B,C,D=false,H,w,xb,m=new SP.JsGrid.ChangeKeyOnCompleteMap,mb=false,R=[],u=[],k,I,G,K;this.customFieldInfo;this.get_Api=function(){a:;return this._api};this.AttachFullLoadCallback=function(a){R.push(a);mb&&a(o)};this.AttachRowChanged=function(a){u.push(a)};this.GetListId=function(){a:;return b.listId};this.UpdateProperties=function(b){a:;a.UpdateProperties(b,null,null)};this.IsParseAndSetFields=function(a){a:;return a in b.parseAndSetFields};function zb(){a:;SP.JsGrid.PropertyType.Utils.UpdateEditControlForPropType("String",k);SP.JsGrid.PropertyType.Utils.UpdateEditControlForPropType("Hyperlink",I);if(b.spGrid)for(var c=SP.JsGrid.PropertyType.Utils.GetPropTypes(),a=0;a<c.length;a++){var d=c[a];SP.JsGrid.PropertyType.Utils.UpdateDisplayControlForPropType(d,SP.JsGrid.DisplayControl.Type.CSR)}}this.Init=function(A,c,y){a:;a=A;g_ganttControlInstances[a.parentNode.id]=this;b=y;b.viewSelectorId&&EnsureScriptFunc("clienttemplates.js","RenderViewSelectorPivotMenu",function(){a:;var a=RenderViewSelectorPivotMenu({wpq:b.viewSelectorId,viewTitle:b.viewTitle,ListSchema:{ViewSelectorPivotMenuOptions:b.ViewSelectorPivotMenuOptions}});document.getElementById(b.viewSelectorId).innerHTML='<div class="ms-csrlistview-controldiv">'+a+"</div>"});if(c!=null){K=c.AdditionalParams;if(c.SortState!=null&&c.SortState.length==1){var u=c.SortState;r={sortField:u[0].fieldKey,isDescending:u[0].isDescending}}fb(c.AutoFilterState);var j=y.spCsrRenderCtx;if(j!=null){j.inGridMode=false;if(!IsInfiniteScrollSupported(j)){var i=new QstringStruct(j.clvp.PagingString());for(var C in i.filterParams)delete i.filterParams[C];for(var f in i.nonFilterParams)if(f!="Paged"&&f!="PagedPrev"&&f!="PageFirstRow"&&f!="PageLastRow"&&f!="FirstRow"&&f.indexOf("p_")!=0)delete i.nonFilterParams[f];O=i.toString()}j.inGridMode=true}}p=new Array(b.totalItemCount);Cb(b.splookupFieldInfo);this.customFieldInfo=b.customFieldInfo;g=new SP.JsGrid.JsGridControl.Parameters;g.canUserAddColumn=b.canUserAddColumn;g.showAddColumn=b.showAddColumn;g.spGrid=b.spGrid;g.spCsrRenderCtx=b.spCsrRenderCtx;g.qualifier=b.qualifier;if(g.tableViewParams!=null){if(typeof b.bHidableColumns=="boolean")g.tableViewParams.bHidableColumns=b.bHidableColumns;if(typeof b.bMovableColumns=="boolean")g.tableViewParams.bMovableColumns=b.bMovableColumns}k=SP.JsGrid.EditControl.Type.EditBox;G=SP.JsGrid.EditControl.Type.PeoplePicker;if(b.spGrid){k="EDIT_SPGRIDEDITBOX";SP.JsGrid.PropertyType.Utils.RegisterEditControl(k,function(a){a:;return SPG.GetEditBoxEditControl(a)},[]);G="EDIT_SPGPEOPLEPICKER";SP.JsGrid.PropertyType.Utils.RegisterEditControl(G,function(a){a:;return SPG.GetPeoplePickerEditControl(a)},[])}SP.JsGrid.PropertyType.RegisterNewCustomPropType(new SPG.TextMaxLengthPropertyType(Kb(b.customFieldInfo)),SP.JsGrid.DisplayControl.Type.Text,k);SP.JsGrid.PropertyType.RegisterNewCustomPropType(new SPG.DatePropertyType,SP.JsGrid.DisplayControl.Type.Text,k,[SP.JsGrid.WidgetControl.Type.Date]);SP.JsGrid.PropertyType.RegisterNewCustomPropType(new SPG.EditPropertyType,SP.JsGrid.DisplayControl.Type.Image,k);SP.JsGrid.PropertyType.RegisterNewCustomPropType(new SPG.UserPropertyType(this),SP.JsGrid.DisplayControl.Type.Text,G);SP.JsGrid.PropertyType.RegisterNewCustomPropType(new SPG.PercentCompletePropertyType,SP.JsGrid.DisplayControl.Type.Text,k);I=SP.JsGrid.EditControl.Type.Hyperlink;if(b.spGrid){I="EDIT_SPGHYPERLINK";SP.JsGrid.PropertyType.Utils.RegisterEditControl(I,function(a){a:;return SPG.GetEditBoxEditControl(a,true)},[])}var m=b.spGrid&&b.spCsrRenderCtx!=null;if(m){var o="EDIT_SPGMULTILINEPLAINTEXT";SP.JsGrid.PropertyType.Utils.RegisterEditControl(o,function(a){a:;return new SPG.MultilinePlainTextEditControl(a)},[]);var q="EDIT_SPGENHANCEDRICHTEXT";SP.JsGrid.PropertyType.Utils.RegisterEditControl(q,function(a){a:;return new SPG.EnhancedRichTextEditControl(a,b.qualifier)},[])}SP.JsGrid.PropertyType.RegisterNewCustomPropType(new SPG.MultilineTextPropertyType,SP.JsGrid.DisplayControl.Type.Text,m?o:k);SP.JsGrid.PropertyType.RegisterNewCustomPropType(new SPG.EnhancedRichTextPropertyType,SP.JsGrid.DisplayControl.Type.Text,m?q:k);typeof SP.UI.Taxonomy!="undefined"&&SP.UI.Taxonomy&&SP.UI.Taxonomy.ControlRegistration.RegisterGridControls(this,this.customFieldInfo,m);for(var t in b.splookupFieldInfo){var l=b.splookupFieldInfo[t],w=new SPG.LookupPropertyType(t,l);SP.JsGrid.PropertyType.RegisterNewCustomPropType(w,SP.JsGrid.DisplayControl.Type.Text,SP.JsGrid.EditControl.Type.ComboBox);if(l.listId.toUpperCase()==b.listId.toUpperCase()){if(v[l.field]==null)v[l.field]=[];v[l.field].push(w)}}if(b.spGrid){a.SetDelegate(SP.JsGrid.DelegateType.GetFieldEditMode,ac);a.SetDelegate(SP.JsGrid.DelegateType.GetFieldReadOnlyActiveState,Ab);var x=g.styleManager,B=x.columnHeaderStyleCollection;x.UpdateHeaderStyleFromCss(B,{normal:{base:"ms-spgrid-col-header-normal"},normalHover:{base:"ms-spgrid-col-header-normal-hover",elementColor:"ms-spgrid-col-header-elem-bg-colors-normal-hover",elementHoverColor:"ms-spgrid-col-header-elem-hover-bg-colors-normal-hover",elementClickColor:"ms-spgrid-col-elem-colors-click-normal-hover"},partSelected:{base:"ms-spgrid-col-header-part-selected"},partSelectedHover:{base:"ms-spgrid-col-header-part-selected-hover",elementColor:"ms-spgrid-col-header-elem-bg-colors-part-selected-hover",elementHoverColor:"ms-spgrid-col-header-elem-hover-bg-colors-part-selected-hover",elementClickColor:"ms-spgrid-col-elem-colors-click-part-selected-hover"},allSelected:{base:"ms-spgrid-col-header-all-selected"},allSelectedHover:{base:"ms-spgrid-col-header-all-selected-hover",elementColor:"ms-spgrid-col-header-elem-bg-colors-all-selected-hover",elementHoverColor:"ms-spgrid-col-header-elem-hover-bg-colors-all-selected-hover",elementClickColor:"ms-spgrid-col-elem-colors-click-all-selected-hover"}});this.GetCLVPQString=function(){a:;var h=a.GetSpCsrRenderCtx(),g=null;if(r!=null)g="SortField="+r.sortField+"&SortDir="+(r.isDescending?"Desc":"Asc");var c=new QstringStruct(ReconcileQstringFilters(ReconcileQstringFilters(O,z),g));if(c.nonFilterParams.SortField!=null)c.nonFilterParams.SortField=Z(c.nonFilterParams.SortField);for(var f in c.filterParams){var d="FilterField",e=c.filterParams[f][d];if(e==null){d="FilterFields";e=c.filterParams[f][d]}c.filterParams[f][d]=Z(e)}if(b.viewRootFolder)c.nonFilterParams.RootFolder=escapeProperly(b.viewRootFolder);return c};this.GetUnfilteredHierarchyMap=function(){a:;return a.GetUnfilteredHierarchyMap()}}d=b.parentColumnName!=null&&b.taskOrderColumnName!=null;if(b.hierarchyTasksDataServiceUrl!=null&&b.hierarchyTasksDataServiceUrl!=""){d=true;N=new SP.HierarchyTasksWebManager(b.hierarchyTasksDataServiceUrl+ajaxNavigate.get_search());e=new SP.JsGrid.WebMethodDataSource(N.RegisterMethod(new SP.WebMethod("GetGridJsonForList",ib)),N.RegisterMethod(new SP.WebMethod("GetGridJsonForList",ib)),N,a,null,null,true);e.BeginFullLoad(qb,null,g)}else{e=new SP.JsGrid.SharePointDataSource(new SP.WebMethod("Populate",function(){a:;return{}}),new SP.WebMethod("Init",function(){a:;return{}}),new SP.WebMethod("ComputeDataRange",function(){a:;return{}}),{Populate:function(){a:;var e=h.GetCLVPQString(),d=e.toArray();d.push("ShowInGrid=True");var b=a.GetSpCsrRenderCtx(),c="?"+d.join("&");b.queryString=c;b.clvp.RefreshPaging(c)},Init:function(e,b){a:;b(c);Tb(a.GetTopRowIndex())},ComputeDataRange:function(a){a:;return Qb(a)}},a,function(){},zb);e.BeginFullLoad(qb,function(){},g)}SP.GanttControl.Instances.push(h);for(var s=SP.GanttControl.FnGanttCreationCallback,n=0;n<s.length;n++)s[n](h)};this.TryDispose=function(c){var d=this,b=function(){a:;d.TryDisposeInternal(c)};a.FinalizeEditing(b,b)};this.TryDisposeInternal=function(e,g){var f=this,d=A||B||C||D;if(g&&!H||xb)return;if(a.AnyUncomittedEntryRecords()){a.JumpToEntryRecord();d=true}if(!SP.Internal.JS.IsAssocArrayEmpty(c)){hb();d=true}if(a.AnyErrors()){w&&commonModalDialogClose(0);w=true;Y(Strings.STS.L_SPGanttDisposeErrorDialogTitle,Strings.STS.L_SPGanttDisposeErrorDialogBody,Strings.STS.L_SPGanttDisposeErrorDialogFixButton,Strings.STS.L_SPGanttDisposeDialogDiscardButton,false,b)}else if(d){if(!w){H=true;w=true;Y(Strings.STS.L_SPGanttDisposeSavingDialogTitle,Strings.STS.L_SPGanttDisposeSavingDialogBody,null,Strings.STS.L_SPGanttDisposeDialogLeaveButton,true,b,true)}H&&setTimeout(function(){a:;f.TryDisposeInternal(e,true)},200)}else EnsureScriptFunc("sp.ui.dialog.js","SP.UI.ModalDialog.get_childDialog",function(){a:;var a=SP.UI.ModalDialog.get_childDialog();if(w)commonModalDialogClose(1);else b(1)});function b(a,b){a:;w=false;if(a==1){f.Dispose();e(b)}else H=false}};this.Dispose=function(){a:;DetachEvent("beforeunload",sb);xb=true;a.Dispose();this._api=null};function Y(q,l,g,j,m,o,h){var f=document.createElement("div"),d=document.createElement("p");if(m){var e=document.createElement("img");e.src="/_layouts/15/images/loadingcirclests16.gif";e.style.paddingRight="10px";d.appendChild(e)}var n=document.createTextNode(l);d.appendChild(n);f.appendChild(d);var c=document.createElement("div");c.className="ms-alignRight";var b=document.createElement("button");b.setAttribute("type","button");var k=document.createTextNode(j);b.appendChild(k);b.onclick=function(){a:;commonModalDialogClose(1,{markGridSerializerAsStale:h})};c.appendChild(b);if(g!=null){var a=document.createElement("button");a.setAttribute("type","button");var i=document.createTextNode(g);a.appendChild(i);a.onclick=function(){a:;commonModalDialogClose(0)};c.appendChild(a)}f.appendChild(c);var p={html:f,title:q,dialogReturnValueCallback:o,autoSizeStartWidth:375};EnsureScriptFunc("sp.ui.dialog.js","SP.UI.ModalDialog.showModalDialog",function(){a:;SP.UI.ModalDialog.showModalDialog(p);if(a!=null)a.focus();else b.focus()})}function qb(c){a:;x=c.tableViewParams;F=c.tableViewParams.rowViewParams.hierarchyMode==SP.JsGrid.HierarchyMode.Grouping;o=c.tableViewParams.gridFieldMap;if(SP&&SP.Res)c.name=SP.Res.ganttListName;else c.name="";c.enabledRowHeaderAutoStates.Add(SP.JsGrid.RowHeaderAutoStyleId.Dirty);hc=c.tableViewParams.bNewRowEnabled=!F&&b.listPermissions&SPG.Permissions.addListItems&&(b.spCsrRenderCtx==null||b.spCsrRenderCtx.ListSchema.IsDocLib!="1");if(c.tableViewParams.ganttParams!=null){c.tableViewParams.ganttParams.fnGetGanttBarDate=dc;c.tableViewParams.ganttParams.fnGetGanttBarStyleIds=Vb;c.tableViewParams.ganttParams.fnGetPredecessors=ec}c.styleManager.RegisterCellStyle("CheckmarkStyle",SP.JsGrid.Style.CreateStyle(SP.JsGrid.Style.Type.Cell,{textAlign:"center"}));var i=c.tableViewParams.columns.GetColumnByKey("Checkmark");if(i!=null)i.fnGetCellStyleId=function(){a:;return"CheckmarkStyle"};(c.tableViewParams.ganttParams!=null||d)&&c.styleManager.RegisterCellStyle("Summary",SP.JsGrid.Style.CreateStyle(SP.JsGrid.Style.Type.Cell,{fontWeight:"bold"}));gc=c.tableViewParams.bEditingEnabled=b.listPermissions&SPG.Permissions.editListItems;a.SetDelegate(SP.JsGrid.DelegateType.GetRecordEditMode,Wb);a.AttachEvent(SP.JsGrid.EventType.OnRightClick,jc);var f=c.tableViewParams.columns.GetColumnByKey("Edit");if(f!=null){f.fnShouldLinkSingleValue=function(){a:;return true};f.fnSingleValueClicked=Db}var e=c.tableViewParams.columns.GetColumnByKey("Title");if(e!=null){e.fnShouldLinkSingleValue=Pb;e.fnSingleValueClicked=Bb}a.SetDelegate(SP.JsGrid.DelegateType.AutoFilter,ic);a.SetDelegate(SP.JsGrid.DelegateType.Sort,oc);a.SetDelegate(SP.JsGrid.DelegateType.NextPage,mc);a.SetDelegate(SP.JsGrid.DelegateType.AddNewColumn,y);a.SetDelegate(SP.JsGrid.DelegateType.AddNewColumnMenuItems,yb);a.SetDelegate(SP.JsGrid.DelegateType.GetAutoFilterEntries,Ib);a.SetDelegate(SP.JsGrid.DelegateType.LaunchFilterDialog,Rb);a.SetDelegate(SP.JsGrid.DelegateType.CreateEntryRecord,Ub);a.SetDelegate(SP.JsGrid.DelegateType.TryInsertEntryRecord,nb);a.SetDelegate(SP.JsGrid.DelegateType.TryCreateProvisionalRecord,nb);a.SetDelegate(SP.JsGrid.DelegateType.DeleteRecords,T);a.SetDelegate(SP.JsGrid.DelegateType.RemoveColumnFromView,Jb);a.SetDelegate(SP.JsGrid.DelegateType.GetGridRowStyleId,c.tableViewParams.ganttParams!=null||d?Hb:null);a.SetDelegate(SP.JsGrid.DelegateType.CanReorderRecords,function(){a:;return b.canShowReorderUI});a.SetDelegate(SP.JsGrid.DelegateType.OnBeforeRecordReordered,Gb);a.AttachEvent(SP.JsGrid.EventType.OnRowEscape,kc);a.AttachEvent(SP.JsGrid.EventType.OnRowFocusChanged,Zb);a.AttachEvent(SP.JsGrid.EventType.OnPropertyChanged,Yb);a.AttachEvent(SP.JsGrid.EventType.OnRecordInserted,ab);a.AttachEvent(SP.JsGrid.EventType.OnRecordDeleted,ab);a.AttachEvent(SP.JsGrid.EventType.OnRecordsReordered,Sb);a.AttachEvent(SP.JsGrid.EventType.OnBeforePropertyChanged,Fb);a.AttachEvent(SP.JsGrid.EventType.OnBeginRenameColumn,Nb);a.AttachEvent(SP.JsGrid.EventType.OnEndRenameColumn,Xb);a.AttachEvent(SP.JsGrid.EventType.OnSingleCellKeyDown,Ob);j=b.canModifyHierarchy&&(!K||!K.missingParentLinks)&&x.rowViewParams.sortState.length==1&&x.rowViewParams.sortState[0].fieldKey=="Order"&&z==null;if(b.spCsrRenderCtx!=null&&b.spCsrRenderCtx.ListData!=null&&b.spCsrRenderCtx.ListData.ForceNoHierarchy){d=j=false;c.tableViewParams.rowViewParams.hierarchyMode=SP.JsGrid.HierarchyMode.None}if(d){j&&a.SetDelegate(SP.JsGrid.DelegateType.InsertRecord,h.InsertProvisionalItemBeforeFocusedItem);a.SetDelegate(SP.JsGrid.DelegateType.IndentRecords,function(){a:;h.IndentItems(h.get_SelectedItems())});a.SetDelegate(SP.JsGrid.DelegateType.OutdentRecords,function(){a:;h.OutdentItems(h.get_SelectedItems())})}if(b.listDirection=="rtl")c.isRTL=true;else if(b.listDirection=="ltr")c.isRTL=false;Lb(c);a.Init(c);lc=c.commandMgr;AttachEvent("beforeunload",sb);SP.SPGantt.InstrumentedApi.ExecuteWithJsApiLoaded(function(){a:;SP.SPGantt.InstrumentedApi.SPGantt.WrapImplementationInApiAndMarkInitComplete(h)});for(var g=0;g<R.length;g++)R[g](o);mb=true}function Lb(c){a:;var b=c.styleManager;b.groupingStyles=null;if(c.spGrid){b.gridPaneStyle.backgroundColor="transparent";b.defaultCellStyle.textAlign=c.isRTL?"right":"left";b.defaultCellStyle.backgroundColor="transparent";var a=b.columnHeaderStyleCollection;a.normal.innerBorderColor="transparent";a.normal.eyeBrowColor="transparent";a.partSelected.innerBorderColor="transparent";a.partSelected.eyeBrowColor="transparent";a.allSelected.innerBorderColor="transparent";a.allSelected.eyeBrowColor="transparent"}}function ib(){a:;return{listId:b.listId,viewId:b.viewId}}this.ZoomInGantt=function(){a:;a.SetGanttZoomLevel(a.GetGanttZoomLevel()-1)};this.ZoomOutGantt=function(){a:;a.SetGanttZoomLevel(a.GetGanttZoomLevel()+1)};this.ScrollGanttToFocusedItem=function(){a:;var d=bc();if(d!=null){var c=d.GetDataValue(b.startColumnName);if(c==null)c=d.GetDataValue(b.finishColumnName);c!=null&&a.ScrollGanttToDate(c)}};this.get_SelectedItems=function(){a:;for(var c=a.GetSelectedRecordKeys(),e=[],b=0;b<c.length;b++){var d=c[b];!a.IsGroupingRecordKey(d)&&!a.IsEntryRecordKey(d)&&!a.IsProvisionalRecordKey(d)&&e.push(c[b])}return e};this.get_SelectedItemsIncludingProvisionalItems=function(){a:;for(var c=a.GetSelectedRecordKeys(),e=[],b=0;b<c.length;b++){var d=c[b];!a.IsGroupingRecordKey(d)&&!a.IsEntryRecordKey(d)&&e.push(c[b])}return e};this.AddItemsToTimeline=function(c){a:;var g=a.GetSelectedRecordKeys();if(c!=null&&c.length&&c.length>0){for(var e=[],d=0;d<c.length;d++){var f={};f.id=c[d];e.push(f)}AddItemsToTimeline(e,b.listId,b.selectedTimelineView)}};this.DeleteSelectedItems=function(){a:;T()};this.LaunchEditItemFormForItem=function(a){a:;ub(true,a)};this.LaunchViewItemFormForItem=function(a){a:;ub(false,a)};function ub(h,d){a:;var c=GetCurrentCtx(),a=h?c.editFormUrl:c.displayFormUrl,g=a.indexOf("?")==-1?"?":"&",b=e.tableCache.GetCachedRecord(d).GetDataValue("_ContentTypeId"),f=b!=null&&b!=""?"&ContentTypeID="+b:"";a=a+g+"ID="+d+f;a=AddSourceToUrl(a)+GetRootFolder(c);EditItem2(null,a)}function P(e){for(var f=a.GetSpCsrRenderCtx(),c=f.ListSchema.Field,b=0;b<c.length;b++){var d=c[b];if(d.RealFieldName==unescapeProperly(e))return d}}function Z(a){var b=P(a);return b==null?a:escapeProperly(b.Name)}function bc(){a:;var c=a.GetFocusedItem(),b;if(c!=null)b=e.tableCache.GetCachedRecord(c.recordKey);return b}function sb(){a:;var b=new URI(ajaxNavigate.get_href());if(!Boolean(b.getQueryParameter("Minimized")))if(a.AnyUncomittedEntryRecords()||a.AnyUncomittedProvisionalRecords()||!SP.Internal.JS.IsAssocArrayEmpty(c))return SP.Res.changesHaveNotBeenSaved;else if(A||B||C)return SP.Res.savingToServer;return undefined}function Mb(){a:;var d=new SP.Utilities.Set;for(var b in c){if(a.AnyErrorsInRecord(b)&&(!(b in n)||!n[b].bCommunicationsError)){d.Add(b);continue}var e=c[b];for(var g in e)if(e[g].changeKey.GetVersionNumber()in s){d.Add(b);break}}var f=new SP.Utilities.Set(c);return f.Difference(d).GetCollection()}function cb(a){a:;return a in c}function kb(b){a:;if(b in c){var d=function(i){a:;a.Focus();if(i!=SP.UI.DialogResult.OK)return;var d=c[b];delete c[b];var h=db(d),f=[];for(var e in d){var g=d[e];f.push(SP.JsGrid.CreateValidatedPropertyUpdate(b,e,g.oldProp.data,g.oldProp.localized))}a.UpdateProperties(f,null,h)};Y(Strings.STS.L_SPGanttDiscardChangesDialogTitle,Strings.STS.L_SPGanttDiscardChangesDialogMessage,Strings.STS.L_SPNo,Strings.STS.L_SPYes,false,d)}}function kc(b){a:;var a=b.recordKey;cb(a)&&kb(a)}function Fb(g){a:;if(!b.spGrid)return;var i=g.recordKey,e=a.GetRecord(i),h=g.fieldKey;if(e.properties[h]==null)return;var c=e.properties[h].propType;if(c.ID=="SPMultilineText"||c.ID=="SPEnhancedRichText"||c.ID=="TaxonomyField"||c.ID=="TaxonomyField_MultiValue")return;var d=e.fieldRawDataMap.csrInfo;if(d==null)return;if(f!=null&&f[i]!=null)return;if(!SP.JsGrid.Internal.IsNoOpChange(g,e)){d.stale=d.stale||{};d.stale[h]=true}}function Yb(d,k){a:;if(a.IsProvisionalRecordKey(d.recordKey))return;if(d.fieldKey in b.computedFields)return;g(d);if(d.changeKey==E)return;n[d.recordKey]!=null&&!n[d.recordKey].bCommunicationsError&&V(d.recordKey);!k&&i(d);j(d);h(d);l(d);var f=a.GetFocusedItem();d.validationState==SP.JsGrid.ValidationState.Valid&&(f!=null&&d.recordKey!=f.recordKey||e.tableCache.GetRecordCount()+(x.bNewRowEnabled?1:0)==1)&&J();function g(){a:;var a=v[d.fieldKey];if(a!=null)for(var b=0;b<a.length;b++)a[b].InvalidateCache()}function l(a){a:;if(a.validationState==SP.JsGrid.ValidationState.Pending||a.validationState==SP.JsGrid.ValidationState.Valid){var b=c[a.recordKey];if(b==null)c[a.recordKey]=b={};b[a.fieldKey]!=null&&b[a.fieldKey].changeKey.Release();b[a.fieldKey]=a;a.changeKey.Reserve()}else{var b=c[a.recordKey];if(b!=null&&b[a.fieldKey]!=null){b[a.fieldKey].changeKey.Release();delete b[a.fieldKey]}}}function h(b){a:;var a=b.changeKey.GetVersionNumber(),c=[b.recordKey,b.fieldKey,a].join();if(b.validationState==SP.JsGrid.ValidationState.Pending){Q.Add(c);if(!(a in s))s[a]=0;s[a]++}else if(Q.Contains(c)){Q.Remove(c);s[a]--;if(s[a]==0)delete s[a]}}function j(b){a:;if(b.validationState==SP.JsGrid.ValidationState.Valid&&b.fieldKey=="Title"&&e.tableCache.GetCachedRecord(b.recordKey).GetDataValue("_FolderLink")){var c=SP.JsGrid.CreateValidatedPropertyUpdate(b.recordKey,"FileLeafRef",b.newProp.data,b.newProp.localized);a.UpdateProperties([c],null,b.changeKey)}}function i(c){a:;var f={},i=a.GetRecord(c.recordKey),d=i.fieldRawDataMap._ContentTypeId;if(d!=null&&d in b.contentTypes)for(var g=b.contentTypes[d].RequiredFields,e=0;e<g.length;e++){var h=g[e];f[h]=1}c.validationState==SP.JsGrid.ValidationState.Valid&&(c.fieldKey in b.requiredFields||c.fieldKey in f)&&(c.newProp.HasLocalizedValue()&&(c.newProp.localized==""||c.newProp.localized==null)||c.newProp.HasDataValue()&&c.newProp.data==null)&&a.SetCellError(c.recordKey,c.fieldKey,SP.Res.requiredField15)}}function ab(){a:;for(var c in v)for(var b=v[c],a=0;a<b.length;a++)b[a].InvalidateCache()}function Zb(){a:;J()}function oc(a){a:;if(g.spGrid){O=null;r={sortField:a[0].columnName,isDescending:a[0].isDescending};jb();e.RefreshRowView(false,tb)}else rb(a,x.rowViewParams.autoFilterState)}function tb(c,b){a:;a.SetRowView(c);K=b;RefreshCommandUI()}function Jb(b){a:;var a=q(c,d);a.view.get_viewFields().remove(b);a.view.update();a.context.executeQueryAsync();function c(){}function d(){a:;throw"Failed to delete column "+b;}}function Nb(){a:;D=true}function Ob(b){a:;if(b.fieldKey=="Checkmark"&&window.CheckMarkFieldTemplate&&b&&b.eventInfo&&b.eventInfo.keyCode==32){var c=document.getElementById(window.CheckMarkFieldTemplate.GetCheckMarkId(a.GetSpCsrRenderCtx(),b.recordKey));c&&c.OnClickCheckmark()}}function Xb(b){a:;var d=b.columnKey,c=b.newColumnTitle,g=b.originalColumnTitle;if(c==g){D=false;return}var f=q(h,i),e=f.list.get_fields().getByInternalNameOrTitle(d);e.set_title(c);e.update();f.context.executeQueryAsync();function h(){a:;D=false;var b=a.GetSpCsrRenderCtx();b!=null&&SPGridFetchSchema(b.listName,b.view,function(a){a:;b.ListSchema=a})}function i(){a:;D=false;throw"Failed to rename column "+d+" with name "+c;}}function y(c,d,h){a:;var i=h!=null&&h.length>0?h:c,t=Math.random().toString(36).substring(2,7),l=null,s=97,r=String.fromCharCode(s+Math.floor(Math.random()*26)),t=r+Math.random().toString(36).substring(2,5);switch(c){case"Text":case"Note":case"Number":case"Currency":case"DateTime":case"Boolean":case"URL":case"User":var f=q(p,m),j="<Field Name='"+t+"' DisplayName='"+STSHtmlEncode(i)+"' Type='"+c+"'";if(c=="User")j+=" List='UserInfo'";j+=" />";var k=f.list.get_fields().addFieldAsXml(j,false,SP.AddFieldOptions.defaultValue|SP.AddFieldOptions.addFieldInternalNameHint);l=f.view;k.update();f.context.load(k);f.context.load(l);f.context.executeQueryAsync();return;case"Choice":case"Lookup":case"Calculated":case"BusinessData":case"MoreColumnTypes":var g={};g.title=SP.JsGrid.Res.addColumnName;g.dialogReturnValueCallback=n;var u=c=="Choice"||c=="Calculated"?"FldNew.aspx":"FldNewEx.aspx";g.url=o(u,c);var v=SP.UI.ModalDialog.showModalDialog(g);return}function p(){a:;var c=k.get_internalName(),g=SP.JsGrid.Internal.Property.GetPropType(d.propType),f;if(g.ID=="SPDateTime"){f=new SP.JsGrid.GridField(c,d.hasData,d.hasLocalized,null,null,null,false,null);b.parseAndSetFields[c]=1}else f=new SP.JsGrid.GridField(c,d.hasData,d.hasLocalized);g.ID=="SPUser"&&g.SetPeoplePickerDefaultSettings(c);f.SetSingleValuePropType(g);e.AddColumn(f);var p=new SP.JsGrid.ColumnInfo(i,null,c,100);a.AddColumn(p,f);a.ShowColumn(c);a.EnsurePaneWidth();a.NotifyDataAvailable();a.RenameColumn(c);if(l!=null){var h=q(j,m),n=h.view,o=n.get_viewFields();o.add(c);n.update();h.context.executeQueryAsync()}else j();function j(){a:;var b=a.GetSpCsrRenderCtx();b!=null&&SPGridFetchSchema(b.listName,b.view,function(a){a:;for(var g=a.Field.length,d=0;d<g;d++){var e=a.Field[d];if(e.RealFieldName==c)break}f.csrInfo=e;b.ListSchema=a})}}function m(){a:;throw"Failed to add new column "+i+" to view";}function n(a){a:;a==SP.UI.DialogResult.OK&&RefreshOnDialogClose(a)}function o(c,d){a:;var a=[];a.push(SP.Utilities.Utility.getLayoutsPageUrl(c));a.push("?List=");a.push(b.listId);a.push("&AddToView=");a.push(b.viewId);a.push("&FieldTypeParam=");a.push(d);a.push("&IsDlg=");a.push(1);return a.join("")}}function yb(d){a:;var a={SPUser:{propType:"SPUser",hasData:true,hasLocalized:true},String:{propType:"String",hasData:false,hasLocalized:true},Hyperlink:{propType:"Hyperlink",hasData:true,hasLocalized:false},SPDateTime:{propType:"SPDateTime",hasData:false,hasLocalized:true},DropdownBoolean:{propType:"DropdownBoolean",hasData:true,hasLocalized:false}},b={Text:{Desc:Strings.STS.L_AddColumnDefaultName_Text,FnOnClick:function(){a:;y("Text",a.String,Strings.STS.L_AddColumnDefaultName_Text)}},Number:{Desc:Strings.STS.L_AddColumnDefaultName_Number,FnOnClick:function(){a:;y("Number",a.String,Strings.STS.L_AddColumnDefaultName_Number)}},DateTime:{Desc:Strings.STS.L_AddColumnDefaultName_DateAndTime,FnOnClick:function(){a:;y("DateTime",a.SPDateTime,Strings.STS.L_AddColumnDefaultName_DateAndTime)}},User:{Desc:Strings.STS.L_AddColumnDefaultName_PersonOrGroup,FnOnClick:function(){a:;y("User",a.SPUser,Strings.STS.L_AddColumnDefaultName_PersonOrGroup)}},MoreColumnTypes:{Desc:Strings.STS.L_AddColumnDefaultName_MoreColumnTypes,FnOnClick:function(){a:;y("MoreColumnTypes")}}};for(var e in b){var c=b[e];d.InsertMenuItem(c.Desc,c.FnOnClick)}}function mc(){a:;var f=a.GetTopRowIndex(),c=a.GetVisibleRecordCount(),d=f+c-1;if(d==b.totalItemCount)return;var e=d+c;a.ScrollCellIntoView(Math.min(e,b.totalItemCount))}function fb(a){a:;var c=1;for(var b in a){var d="FilterField",e="FilterValue";if(a[b].indexOf(";#")!=-1){d="FilterFields";e="FilterValues"}if(z==null)z="";z+="&"+d+c+"="+escapeProperly(b)+"&"+e+c+"="+escapeProperly(a[b]);c++}}function ic(a){a:;if(g.spGrid){z=null;O=null;fb(a);jb();e.RefreshRowView(false,tb)}else rb(x.rowViewParams.sortState,a)}function rb(e,c){a:;var f=SP.Utilities.UrlBuilder.urlCombine(SP.PageContextInfo.get_webServerRelativeUrl(),b.viewUrl);window.location.href=f+a(e,c);function a(a,c){a:;var f="?RootFolder="+escapeProperly(b.viewRootFolder)+(d?"":"&FolderCTID="+b.folderContentTypeId),g=1;for(var e in c){var h="FilterField",i="FilterValue";if(c[e].indexOf(";#")!=-1){h="FilterFields";i="FilterValues"}f+="&"+h+g+"="+escapeProperly(e)+"&"+i+g+"="+escapeProperly(c[e]);g++}if(a!=null&&a.length>0)f+="&SortField="+escapeProperly(a[0].columnName)+"&SortDir="+(a[0].isDescending?"Desc":"Asc");return f}}function Ib(n,g,o,l,k){a:;var m=$get(b.iframeId),d="",f=0,e,c=b.filterLink;if(!c)if(b.spGrid&&b.spCsrRenderCtx!=null)c=b.spCsrRenderCtx.queryString;else c=window.location.href;do{f++;e=c.match("FilterField"+f+"=[^&]*&FilterValue"+f+"=[^&]*");if(e!=null)d=d+"&"+e}while(e);var j=c.match("MembershipGroupId=[^&]*");if(j!=null)d+="&"+j;var h=c.match("RootFolder=[^&]*");if(h!=null)d+="&"+h;var i=c.match("InstanceID=[^&]*");if(i!=null)d+="&"+i;t={FieldName:g,OnSuccess:l,OnFailure:k};m.src=SP.Utilities.Utility.getLayoutsPageUrl("filter.aspx")+"?ListId="+b.listId+"&FieldInternalName="+escapeProperly(g)+"&ViewId="+b.viewId+"&FilterOnly=1&Filter=1"+d+"&CallbackFn=OnJsGridIframeLoad&CallbackParam="+a.parentNode.id}this.OnAutoFilterReturn=function(){a:;var a=null;a=document.getElementById(b.iframeId);if(a!=null){var e=null;if(a.contentDocument)e=a.contentDocument;else if(a.contentWindow&&a.contentWindow.document)e=a.contentWindow.document;else if(a.document)e=a.document;if(e!=null){var g=e.getElementById("diidFilter"+t.FieldName);if(g!=null){var i=g.childNodes.length;if(i<=500){for(var d=g.childNodes,f,h=[],c=1;c<i;c++){if(d[c].innerText)f=d[c].innerText;else if(d[c].textContent)f=d[c].textContent;else f=d[c].innerHTML;h.push({displayString:f,dataValue:d[c].value})}var j={};j[t.FieldName]=h;t.OnSuccess(j);t=null;return}}}}t.OnFailure();t=null};function Rb(){a:;alert("launch filter dialog here")}function J(){a:;U!=null&&clearTimeout(U);U=setTimeout(hb,500)}function pb(k,n){a:;var j=null,i=a.GetSpCsrRenderCtx();if(i!=null){for(var g=['<FieldRef Name="ID"/>'],f=i.ListSchema.Field,d=0;d<f.length;d++)g.push('<FieldRef Name="'+f[d].Name+'"/>');var b=[],e=0,c=0;for(var l in k){e++;b.push(["<Eq>",'<FieldRef Name="ID" />','<Value Type="Number">',l,"</Value>","</Eq>"].join(""));if(e>1){b.push("</Or>");c++}}var h=[];while(c>0){h.push("<Or>");c--}b=h.concat(b).join("");var m=['<View Scope="RecursiveAll">',"<ViewFields>"].concat(g).concat(["</ViewFields>","<Query>","<OrderBy>",'<FieldRef Name="ID"/>',"</OrderBy>","<Where>"]).concat(b).concat(["</Where>","</Query>","</View>"]).join("");j=n.renderListData(m)}return j}function vb(b,g,f){a:;for(var e=b.get_value(),b=JSON.parse(e),d=null,c=0;c<b.Row.length;c++)if(b.Row[c].ID==f){d=b.Row[c];break}ULS.AssertJS("SPGantt",d!=null,"Should be able to find the row we're querying for");a.GetRecord(g).fieldRawDataMap.csrInfo=d;EnsureScriptFunc("mQuery.js","m$",function(){a:;var c=a.GetSpCsrRenderCtx();c.ListData=MergeListData(c.ListData,b)})}function wb(){a:;var b=a.GetSpCsrRenderCtx();if(b==null)return;PostRenderAfterJSGridRender(b)}function db(c){a:;var a=null;for(var d in c){var b=c[d].changeKey;a=a==null||b.GetVersionNumber()>a.GetVersionNumber()?b:a}return a}function bb(b,k,j,e,g){a:;var f=null;switch(k){case SP.ClientErrorCodes.invalidFieldValue:a.SetCellError(b,j.split(",")[1],e);break;case SP.ClientErrorCodes.docAlreadyExists:a.SetCellError(b,"Title",SP.Res.docAlreadyExists);break;case SP.ClientErrorCodes.fieldValueFailedValidation:for(var d=g.get_fieldFailures(),c=0;c<d.length;c++)a.SetCellError(b,d[c].get_name(),d[c].get_message());break;case SP.ClientErrorCodes.itemValueFailedValidation:var h=g.get_itemFailure(),i=h?h.get_message():e;f=M(b,i,false);break;default:f=M(b,e,false)}return f}function hb(){a:;var e=Mb();if(SP.Internal.JS.IsAssocArrayEmpty(e))return;if(!s(e))return;var j=q(v,x),k={};for(var n in e){var r=new SP.ExceptionHandlingScope(j.context),t=r.startScope(),d=j.list.getItemById(n),h=f[n];for(var g in h){var i=h[g],l=eb(i.newProp,i.propType);if(g in b.parseAndSetFields){d.parseAndSetFieldValue(g,l);if(b.spCsrRenderCtx!=null&&b.spCsrRenderCtx.ListTemplateType===106)if(g==="EndDate"&&!h.EventDate&&b.spCsrRenderCtx.CurrentItem!=null&&b.spCsrRenderCtx.CurrentItem.EventDate)d.parseAndSetFieldValue("EventDate",b.spCsrRenderCtx.CurrentItem.EventDate);else g==="EventDate"&&!h.EndDate&&b.spCsrRenderCtx.CurrentItem!=null&&b.spCsrRenderCtx.CurrentItem.EndDate&&d.parseAndSetFieldValue("EndDate",b.spCsrRenderCtx.CurrentItem.EndDate)}else if(i.propType!=null&&(i.propType.ID=="TaxonomyField"||i.propType.ID=="TaxonomyField_MultiValue")){var y=j.list.get_fields(),z=y.getByInternalNameOrTitle(g);z.validateSetValue(d,l)}else d.set_item(g,l)}d.update();d.get_fieldValuesAsText().retrieve();d.retrieve();t.dispose();k[n]={item:d,scope:r}}var w=pb(e,j.list);j.context.executeQueryAsync();function v(){a:;for(var d in e){var j=k[d].scope;if(j.get_hasException()){bb(d,j.get_serverErrorCode(),j.get_serverErrorValue(),j.get_errorMessage(),j.get_serverErrorDetails());for(var c in f[d])m.CallFunctions(f[d][c].changeKey.GetVersionNumber(),false)}else{var g=k[d].item,n=g.get_fieldValuesAsText().get_fieldValues();a.GetSpCsrRenderCtx()!=null&&vb(w,d,g.get_id());var i=f[d],v=db(i),s={};for(var c in o)if(c in n){var t=i[c]&&i[c].changeKey,q=t!=null;if(q||c in b.computedFields){var h=gb(g.get_item(c),g.get_fieldValuesAsText().get_item(c),o[c].GetPropType(),c),x=SP.JsGrid.CreateValidatedPropertyUpdate(d,c,h&&h.data,h&&h.localized);E=q?t:v;a.UpdateProperties([x],null,E);if(q){E.Release();var l;if(o[c].GetPropType().ID=="SPDateTime"){var y=g.get_item(c);if(y==null)l=n[c];else l=SP.DateTimeUtil.IntlDate.createFromJsUtcDate(h.data,_spRegionalSettings.calendarType).toJsDate()._toFormattedString("s",Sys.CultureInfo.InvariantCulture)}else l=n[c];s[c]={localizedValue:l}}E=null}}for(var c in i)m.CallFunctions(i[c].changeKey.GetVersionNumber(),true,g.get_id());for(var z=a.GetRecord(d),r=0;r<u.length;r++)u[r](d,s,false);delete f[d];V(d)}}p(e);wb()}function x(){for(var a in e)M(a,SP.Res.serverCommError,true);for(var a in f)for(var b in f[a])m.CallFunctions(h[b].changeKey.GetVersionNumber(),false);p(e)}function s(d){a:;if(A){S=true;return false}A=true;S=false;for(var b in d){a.RemoveRowHeaderState(b,SP.JsGrid.RowHeaderAutoStyleId.Dirty);a.AddBuiltInRowHeaderState(b,SP.JsGrid.RowHeaderStyleId.Transfer)}f=c;c={};return true}function p(e){a:;A=false;S&&setTimeout(J,0);for(var b in e)a.RemoveRowHeaderState(b,SP.JsGrid.RowHeaderStyleId.Transfer);if(SP.Internal.JS.IsAssocArrayEmpty(c))c=f;else for(var b in f)if(c[b]==null)c[b]=f[b];else for(var d in f[b]){c[b][d]!=null&&c[b][d].changeKey.Release();c[b][d]=f[b][d]}f=null}}function M(b,e,d){a:;V(b);var c=a.SetRowError(b,e);n[b]={id:c,bCommunicationsError:d};return c}function V(b){a:;if(b in n){a.ClearRowError(b,n[b].id);delete n[b]}}function Tb(d){a:;for(var f=a._GetPaneManager(),e=f.GetGridPane().GetGridPaneConverter(),g=Math.min(d+b.viewRowLimit,p.length),c=d;c<g;c++)p[c]=e.RowIdxToRecordKey(c)}function jb(){a:;p=new Array(b.totalItemCount)}function Qb(l){a:;for(var c={pos:-1,count:0},i={rangesToFillRequest:1,totalRanges:[]},j=b.viewRowLimit,h=b.totalItemCount,e=a.GetTopRowIndex(),k=a.GetVisibleRecordCount(),g=Math.min(e+k,h),d=e;d<g;d++)if(!p[d]){c.pos=d;break}if(d==e)for(var f=g;f>=e;f--)if(!p[f]){c.pos=Math.max(0,f-j+1);while(c.pos<p.length&&p[c.pos])c.pos++;break}c.callbacks=[l];c.count=Math.min(h-c.pos,j);i.totalRanges.push(c);return i}function Ub(){a:;return e.recordFactory.MakeRecord({},{})}function nb(c,f,s,v){a:;function x(){a:;var b=e.get_fieldValues(),i=e.get_fieldValuesAsText().get_fieldValues();function g(n){a:;var k={},j={};for(var e in o)if(e in b){var g=b[e]==null?null:gb(b[e],i[e],o[e].GetPropType(),e);if(g&&"data"in g)j[e]=g.data;if(g&&"localized"in g)k[e]=g.localized}var h=n.get_id();j.ID=k.ID=h;j.ContentType=k.ContentType=n.get_contentType().get_name();j.Edit=SPG.Permissions.editListItems|SPG.Permissions.deleteListItems;a.RemoveRowHeaderState(c.key(),SP.JsGrid.RowHeaderStyleId.Transfer);s!=null&&s(h,k,j);d&&a.GetHierarchyQueryObject().SetTagObject(h,{order:b.Order});B=false;for(var p=a.GetRecord(h),e=0;e<u.length;e++)u[e](h,k,false);if(f!=null)for(var l=0;l<f.length;l++)m.CallFunctions(f[l].changeKey.GetVersionNumber(),true,h)}var h=a.GetSpCsrRenderCtx();if(h!=null)(function(a,b){a:;var d=q(function(){a:;vb(e,b.recordKey,a.get_id());g(a);var c=b.fieldRawDataMap.csrInfo;h.ListData.Row.push(c);wb()}),c={};c[a.get_id()]=1;var e=pb(c,d.list);d.context.executeQueryAsync()})(e,c);else g(e)}function t(h,b,g){a:;a.RemoveRowHeaderState(c.key(),SP.JsGrid.RowHeaderStyleId.Transfer);var e=g;if(b!=null)e=bb(c.key(),b.get_errorCode(),b.get_errorValue(),b.get_message(),b.get_errorDetails());v!=null&&v(b&&b.get_message(),e);B=false;if(f!=null)for(var d=0;d<f.length;d++)m.CallFunctions(f[d].changeKey.GetVersionNumber(),false)}function w(j){a:;var k=false,l=null;function i(b){a:;if(a.GetColumnByFieldKey(b)==null)l=M(c.recordKey,SP.Res.requiredFieldNotInEditView,false);else a.SetCellError(c.recordKey,b,SP.Res.requiredField15);k=true}for(var e in b.requiredFields){var d;((d=j[e])==null||d.HasLocalizedValue()&&(d.localized==""||d.localized==null)||d.HasDataValue()&&d.data==null)&&i(e)}if(c.fieldRawDataMap!=null&&c.fieldRawDataMap._ContentTypeId!=null){var f=c.fieldRawDataMap._ContentTypeId;if(f!=null&&f in b.contentTypes)for(var h=b.contentTypes[f].RequiredFields,g=0;g<h.length;g++){var e=h[g];((d=j[e])==null||d.HasLocalizedValue()&&(d.localized==""||d.localized==null)||d.HasDataValue()&&d.data==null)&&i(e)}}return{fieldsMissing:k,errorId:l}}a.RemoveRowHeaderState(c.key(),SP.JsGrid.RowHeaderAutoStyleId.Dirty);a.AddBuiltInRowHeaderState(c.key(),SP.JsGrid.RowHeaderStyleId.Transfer);var r={},j={};if(f!=null)for(var h=0;h<f.length;h++){j[f[h].fieldKey]=f[h];r[f[h].fieldKey]=f[h].newProp}var p=w(r);if(p.fieldsMissing){t(null,null,p.errorId);return}var n=q(x,t),k;if(b.viewRootFolder!=null){k=new SP.ListItemCreationInformation;k.set_folderUrl(b.viewRootFolder)}var e=n.list.addItem(k);for(var i in j){var g=j[i],i=g.fieldKey,l=eb(g.newProp,g.propType);if(i in b.parseAndSetFields)e.parseAndSetFieldValue(i,l);else if(g.propType!=null&&(g.propType.ID=="TaxonomyField"||g.propType.ID=="TaxonomyField_MultiValue")){var y=n.list.get_fields(),z=y.getByInternalNameOrTitle(i);z.validateSetValue(e,l)}else e.set_item(i,l)}if(d){e.set_item(b.parentColumnName,lb(c.key()));e.set_item(b.taskOrderColumnName,cc(c.key(),c.newRowNumber))}e.update();e.get_fieldValuesAsText().retrieve();e.retrieve();e.get_contentType().retrieve();n.context.executeQueryAsync();B=true}function q(e,f){a:;var a=new SP.ClientContext(b.webUrl);a.add_requestSucceeded(function(b,a){a:;setTimeout(function(){a:;e(b,a)},0)});a.add_requestFailed(function(b,a){a:;setTimeout(function(){a:;f(b,a)},0)});var d=a.get_web(),c=d.get_lists().getById(b.listId),g=c.get_views().getById(b.viewId);return{context:a,web:d,list:c,view:g}}function Cb(g){a:;l.Hyperlink=function(a){a:;if(a.data==null)return null;var b=new SP.FieldUrlValue;b.set_url(a.data.address);b.set_description(a.data.display);return b};i.Hyperlink=function(a){a:;return a==null?null:{data:{address:a.get_url(),display:a.get_description()},localized:a.get_description()}};i.SPEnhancedRichText=function(a){a:;return a==null||a==""?null:{data:a,localized:a}};_GridValueToSPListValueHelper=function(a){a:;var b;if(a!=null&&"email"in a&&a.email!="")b=a.email.indexOf("@")==-1&&a.email!=a.display?a.email+";#"+a.display:"-1;#"+a.email;else b="-1;#"+a.display;return b};l.SPUser=function(a){a:;var c=a.data==null||a.data==SP.JsGrid.EmptyValue,b=c?"":_GridValueToSPListValueHelper(a.data);return b!=""?b:a.localized==null||a.localized==""?null:"-1;#"+a.localized};i.SPUser=function(a){a:;return{data:[a],localized:a.get_lookupValue()}};l.SPUser_MultiValue=function(e){a:;var c=e.localized,a=e.data,f=a==null||a==SP.JsGrid.EmptyValue,b="";if(!f)if("email"in a)b=_GridValueToSPValueHelper(a);else if(a.length!="undefined")for(var d=0;d<a.length;d++){var g=_GridValueToSPListValueHelper(a[d]);b=b+(b==""?"":";#")+g}return b!=""?b:c==null||c==""?null:"-1;#"+SP.Internal.JS.TokenizeString(c,";").join(";#-1;#")};i.SPUser_MultiValue=function(a){a:;for(var c=[],b=0;b<a.length;b++)c.push(a[b].get_lookupValue());return{data:a,localized:c.join("; ")}};l.DropdownBoolean=function(a){a:;return!!a.data?1:0};i.SPDateTime=function(b,a){a:;var c=new Date(b.valueOf()+_spRegionalSettings.timeZoneInHours*60*60*1e3);return{data:c,localized:a}};var c=function(a){a:;return a.data&&a.data+";#"},d=function(b,a){a:;return{data:b.get_lookupId(),localized:a}},e=function(a){a:;return a.data&&a.data.join(";#;#")+";#"},f=function(b,d){a:;for(var c=[],a=0;a<b.length;a++)c.push(b[a].get_lookupId());return{data:c,localized:d}};for(var b in g){var a=b+"_Lookup";l[a]=c;i[a]=d;a=b+"_Lookup_MultiValue";l[a]=e;i[a]=f}}this.RegisterSPListValueToGridValueConverter=function(b,a){a:;i[b]=a};this.RegisterGridValueToSPListValueConverter=function(b,a){a:;l[b]=a};function eb(a,b){a:;var c;if(b==null)c=a.HasDataValue()?a.data:a.localized;else if(l[b.ID]!=null)c=l[b.ID](a);else c=b.bMultiValue?b.LocStrToLocStrArray(a.localized).join(";#"):a.localized;return c===""?null:c}function gb(a,d,b,e){a:;var c;if(a==null)c=null;else if(i[b.ID]!=null)c=i[b.ID](a,d,e);else c={data:a,localized:b.bMultiValue?b.LocStrArrayToLocStr(nc(a)?a:SP.Internal.JS.TokenizeString(a,";#")):d};return c}function nc(a){a:;return a&&a.constructor==Array}function dc(f,h,g){a:;var e,a=f.GetDataValue(b.startColumnName),c=f.GetDataValue(b.finishColumnName);if(a!=null&&c!=null&&a>c){var i=a;a=c;c=i}if(g==SP.JsGrid.GanttBarDateType.End&&h==1&&a!=null&&c!=null){var d=b.pctCompleteColumnName!=null?f.GetDataValue(b.pctCompleteColumnName):null;d=Math.min(d==null?0:d,1);if(isNaN(d))e=null;else{if(!(c instanceof Date))c=new Date(c);if(!(a instanceof Date))a=new Date(a);deltaMs=Math.abs(c.getTime()-a.getTime());e=d!=0?new Date(a.getTime()+deltaMs*d):null}}else e=g==SP.JsGrid.GanttBarDateType.Start?a:c;return e}function Vb(c){a:;var f=c.GetDataValue(b.startColumnName),e=c.GetDataValue(b.finishColumnName);if(f&&f.constructor==Date&&e&&e.constructor==Date)if(f.getTime()==e.getTime())return[SPG.BarStyle.Milestone];else if(c.GetDataValue("_FolderLink")||d&&!F&&a.GetHierarchyQueryObject().IsParent(c.recordKey))return[SPG.BarStyle.Summary];return[SPG.BarStyle.Standard,SPG.BarStyle.PctComplete]}function Hb(b){a:;if(d&&!a.IsEntryRecordKey(b.recordKey)){var c=a.GetHierarchyQueryObject();if(c!=null)return c.IsParent(b.recordKey)?"Summary":null}return null}function ec(d,a){a:;if(a==null)return null;for(var c=[],b=0;b<a.length;b++)c.push({key:a[b],type:SP.JsGrid.LinkType.FinishStart});return c}function Ab(b){a:;var a=P(b);return a==null||a.GridActiveAndReadOnly==null?null:a.GridActiveAndReadOnly=="TRUE"?SP.JsGrid.ReadOnlyActiveState.ReadOnlyActive:SP.JsGrid.ReadOnlyActiveState.ReadOnlyDisabled}function ac(b){a:;var a=P(b);return a==null?SP.JsGrid.EditMode.ReadOnly:a.AllowGridEditing=="TRUE"&&a.ReadOnly!="TRUE"&&a.XSLRender!="1"?SP.JsGrid.EditMode.ReadWriteDefer:SP.JsGrid.EditMode.ReadOnly}function Wb(a){a:;return a.GetDataValue("Edit")&SPG.Permissions.editListItems?SP.JsGrid.EditMode.ReadWriteDefer:SP.JsGrid.EditMode.ReadOnly}function Pb(a){a:;return a.GetDataValue("_FolderLink")!=null}function Bb(c){a:;var a=SP.Utilities.UrlBuilder.urlCombine(SP.PageContextInfo.get_webServerRelativeUrl(),c.GetDataValue("_FolderLink"));window.location.href=SP.Utilities.UrlBuilder.urlCombine(SP.PageContextInfo.get_webServerRelativeUrl(),b.viewUrl+"?RootFolder="+escapeProperly(a)+"&FolderCTID="+b.folderContentTypeId)}function Db(c){a:;var d=GetCurrentCtx(),a=d.editFormUrl,b=a.indexOf("?")==-1?"?":"&";window.location.href=a+b+"ID="+c.GetDataValue("ID")+"&Source="+escapeProperly(window.location.href)}function Sb(a){a:;X(a.reorderedKeys,a.changeKey);RefreshCommandUI()}function X(j,h,g){a:;var c=a.GetHierarchyQueryObject();function e(e){a:;for(var a={},d=0;d<e.length;d++){var b=c.GetParentKey(e[d]);if(a[b])a[b].push(e[d]);else a[b]=[e[d]]}for(var b in a)a[b]=c.GetKeysInOrder(a[b]);return a}function f(d){a:;var f=c.GetPreviousSibling(d[0]),l=c.GetNextSibling(d[d.length-1]),j=0;if(f!=null)j=c.GetTagObject(f).order;var i;if(l!=null)i=c.GetTagObject(l).order;else if(f!=null){d=[f].concat(d);f=c.GetPreviousSibling(f);j=0;if(f!=null)j=c.GetTagObject(f).order;i=0;for(var e=0;e<d.length;e++)i=Math.max(i,c.GetTagObject(d[e]).order)}else i=100;for(var o=(i-j)/(d.length+1),k=[],e=0;e<d.length;e++){var n=j+o*(e+1);k.push(SP.JsGrid.CreateValidatedPropertyUpdate(d[e],b.parentColumnName,lb(d[0],c),null));k.push(SP.JsGrid.CreateValidatedPropertyUpdate(d[e],b.taskOrderColumnName,null,n));c.SetTagObject(d[e],{order:n})}m.AddMapping(h.GetVersionNumber(),g);a.UpdateProperties(k);J()}var d=e(j);for(var i in d)f(d[i])}function T(c){a:;for(var b=a.GetSelectedRecordKeys(),e=false,d=0;d<b.length;d++)if(b[d]==c){e=true;break}if((!e||b.length==0)&&c!=null)b=[c];h.DeleteItems(b)}this.IsParent=function(b){a:;return!d?false:a.GetHierarchyQueryObject().IsParent(b)};this.DeleteItems=function(i,h){a:;for(var f=[],b=0;b<i.length;b++)!a.IsEntryRecordKey(i[b])&&f.push(i[b]);if(d)f=a.GetHierarchyQueryObject().GetKeysInOrder(f).reverse();for(var g=[],b=0;b<f.length;b++)if(!a.IsProvisionalRecordKey(f[b]))g.push(f[b]);else a.DeleteRecords([f[b]]);for(var b=0;b<f.length;b++){var o=f[b];if(c[o]!=null)delete c[o]}var l=a.GetSpCsrRenderCtx();if(l!=null){EnsureScriptParams("inplview.js","inplview.DeleteSelectedItemsCore",l,g,j(f),k(false));return}if(a.DeleteRecords(f)!=null)if(g.length!=0){C=true;for(var m=q(j(),k(true)),p=ctx.RecycleBinEnabled=="1"&&!ctx.ExternalDataList,b=0;b<g.length;b++){var r=e.tableCache.GetCachedRecord(g[b]);if(r.GetDataValue("Edit")&SPG.Permissions.deleteListItems){var n=m.list.getItemById(g[b]);if(p)n.recycle();else n.deleteObject()}}m.context.executeQueryAsync()}else h!=null&&h(true);function j(){a:;return function(){a:;for(var c=0;c<f.length;c++)for(var d=f[c],e=a.GetRecord(d),b=0;b<u.length;b++)u[b](d,e.properties,true);f!=null&&a.DeleteRecords(f);C=false;h!=null&&h(true)}}function k(a){a:;return function(){a:;a&&alert(SP.Res.deleteFailed);C=false;h!=null&&h(false)}}};this.get_ItemCount=function(){a:;return a.GetViewRecordCount()};this.GetViewIndexOfItem=function(b){a:;return a.GetViewIndexOfRecord(b)};this.TrySelectItem=function(b){a:;a.SelectRowRangeByKey(b,b,false)};this.ToggleAllItems=function(){a:;var d=0,b=a._GetPaneManager().RecordKeyToViewIdx(a.GetLastRecordKey()),c=a.GetSelectedRecordKeys();if(c==null||c.length!=b-d+1)a.SelectRowRange(d,b,false);else a.SelectCellRange(0,0,0,0,false)};this.ReadValue=function(c,b,a){a:;e.tableCache.GetRecordsByKey([c],function(g,f,e){a:;if(e){var d=f[0],c={hasDataValue:d.HasDataValue(b),hasLocalizedValue:d.HasLocalizedValue(b)};if(c.hasDataValue)c.dataValue=d.GetDataValue(b);if(c.hasLocalizedValue)c.localizedValue=d.GetLocalizedValue(b);if(a)return a(true,c)}else a!=null&&a(false)})};this.GetOutlineLevel=function(c,b){a:;e.tableCache.GetRecordsByKey([c],function(f,d,c){a:;if(c){var e=a.GetOutlineLevel(d[0]);if(b)return b(true,e)}else b!=null&&b(false)})};this.get_Columns=function(){a:;return a.GetColumns()};this.get_RequiredColumnKeys=function(){a:;var a=[];for(var c in b.requiredFields)a.push(c);return a};this.InsertItemAtEnd=function(a,b){a:;L(null,a,b)};this.InsertItem=function(a,b,c){a:;L(a,b,c)};this.InsertProvisionalItemBeforeFocusedItem=function(){a:;if(!j)return false;var b=a.GetFocusedItem(),c;if(b!=null){if(a.IsEntryRecordKey(b.recordKey))h.InsertItemAtEnd();else h.InsertItem(b.recordKey);return true}return false};this.CreateSubItem=function(e){a:;if(!d||!j){alert(SP.Res.hierarchyDisabled);return false}var c=a.GetViewIndexOfRecord(e),b;if(c+1>=a.GetViewRecordCount())b=null;else b=a.GetRecordKeyByViewIndex(c+1);L(b,null,null,true)};this.get_IsInsertProvisionalItemBeforeFocusEnabled=function(){a:;var c=a.GetFocusedItem();return j&&c!=null&&b.listPermissions&SPG.Permissions.addListItems?true:false};function L(h,b,l,n){a:;if(!d||!j){alert(SP.Res.hierarchyDisabled);return}var k={Edit:SPG.Permissions.editListItems|SPG.Permissions.deleteListItems},i={};if(b!=null)for(var c=0;c<b.length;c++){if(b[c].propertyValue.hasDataValue)k[b[c].fieldKey]=b[c].propertyValue.dataValue;if(b[c].propertyValue.hasLocalizedValue)i[b[c].fieldKey]=b[c].propertyValue.localizedValue}var f=e.recordFactory.MakeRecord(k,i),g;if(h==null)g=a.InsertProvisionalRecordAfter(a.GetLastRecordKey(),f,b);else g=a.InsertProvisionalRecordBefore(h,f,b);if(n){a.IndentRecords([f.recordKey]);if(a.GetSpCsrRenderCtx()!=null&&!a.GetSpCsrRenderCtx().ListData.HierarchyHasIndention){a.GetSpCsrRenderCtx().ListData.HierarchyHasIndention=true;a.RefreshAllRows()}}m.AddMapping(g.GetVersionNumber(),l);a.ScrollToAndExpandNextErrorOnRecord(null,f.recordKey,null,true);a.TryBeginEdit()}this.InsertProvisionalChildOfFocusedItem=function(){a:;var b=a.GetFocusedItem();if(b!=null){fc(b.recordKey);return true}return false};this.get_IsInsertProvisionalChildOfFocusedItemEnabled=function(){a:;var c=a.GetFocusedItem();return c!=null&&d&&b.listPermissions&SPG.Permissions.addListItems?true:false};function fc(c){a:;var d={Edit:SPG.Permissions.editListItems|SPG.Permissions.deleteListItems},b=e.recordFactory.MakeRecord(d,{});a.InsertProvisionalRecordAfter(c,b,null,true);var f=a.IndentRecords([b.recordKey])}function ob(c){a:;for(var d=[],b=0;b<c.length;b++)!a.IsEntryRecordKey(c[b])&&!a.IsProvisionalRecordKey(c[b])&&d.push(c[b]);return d}this.IndentItems=function(b,c){a:;if(!d||!j){alert(SP.Res.hierarchyDisabled);return}b=ob(b);var e=b.length>0?a.IndentRecords(b):null;if(e!=null){X(b,e,c);if(a.GetSpCsrRenderCtx()!=null&&!a.GetSpCsrRenderCtx().ListData.HierarchyHasIndention){a.GetSpCsrRenderCtx().ListData.HierarchyHasIndention=true;a.RefreshAllRows(null,true)}}else c&&c(false)};this.OutdentItems=function(b,c){a:;if(!d||!j){alert(SP.Res.hierarchyDisabled);return}b=ob(b);if(b.length>0){for(var h=a.GetHierarchyQueryObject(),e=[],f=0;f<b.length;f++)e=e.concat(h.GetAllFollowingSiblings(b[f]));var g=a.OutdentRecords(b);if(g!=null){updateSet=new SP.Utilities.Set;updateSet.AddArray(b);updateSet.AddArray(e);e=updateSet.ToArray();X(e,g,c);if(a.GetSpCsrRenderCtx()!=null&&!a.GetSpCsrRenderCtx().ListData.HierarchyHasIndention){a.GetSpCsrRenderCtx().ListData.HierarchyHasIndention=true;a.RefreshAllRows(null,true)}}else c!=null&&c(false)}else c!=null&&c(false)};this.get_IsReadOnly=function(){a:;return(b.listPermissions&SPG.Permissions.editListItems)!=SPG.Permissions.editListItems};function W(){a:;return b.canReorder&&j&&(r==null||!r.isDescending&&r.sortField=="Order")}function Gb(){a:;if(!W()){alert(SP.Res.hierarchyDisabled);return false}return true}this.get_ContiguousSelectedItemsWithoutEntryItems=function(){a:;var b=a.GetContiguousRowSelectionWithoutEntryRecords();return b==null?null:b.keys};this.MoveItemsUp=function(c,b){a:;if(!W()){alert(SP.Res.hierarchyDisabled);b!=null&&b(false);return}if(c!=null&&c.length>0&&a.CanMoveRecordsUpByOne(c)){var d=a.MoveRecordsUpByOne(c);m.AddMapping(d.GetVersionNumber(),b)}else b!=null&&b(false)};this.MoveItemsDown=function(c,b){a:;if(!W()){alert(SP.Res.hierarchyDisabled);b!=null&&b(false);return}if(c!=null&&c.length>0&&a.CanMoveRecordsDownByOne(c)){var d=a.MoveRecordsDownByOne(c);m.AddMapping(d.GetVersionNumber(),b)}else b!=null&&b(false)};this.GetNodeExpandCollapseState=function(b){a:;return a.GetNodeExpandCollapseState(b)};this.ToggleExpandCollapse=function(b){a:;a.ToggleExpandCollapse(b)};function Eb(c,b){if(typeof SP.UI.Timeline=="undefined")return false;var a=false;RunOperationOnTimelineData(function(){a:;a=SP.UI.Timeline.ListTimelineDatasource.IsRWTimelineAwareOfList(c,b)});return a}function jc(c){a:;if(c.context==SP.JsGrid.ClickContext.RowHeader&&(b.listPermissions&SPG.Permissions.deleteListItems||b.listPermissions&SPG.Permissions.addListItems||b.listPermissions&SPG.Permissions.editListItems)){var e=new SP.JsGrid.ContextMenu(a.parentNode,a.parentNode.id+"_rowcontextmenu");d&&b.listPermissions&SPG.Permissions.addListItems&&e.InsertMenuItem(SP.Res.insertText,function(){a:;L(c.recordKey)},"/_layouts/15/images/newitem.gif",null,F||a.IsEntryRecordKey(c.recordKey));b.listPermissions&SPG.Permissions.deleteListItems&&e.InsertMenuItem(SP.Res.deleteText,function(){a:;T(c.recordKey)},"/_layouts/15/images/delitem.gif",null,a.IsGroupingRecordKey(c.recordKey)||a.IsEntryRecordKey(c.recordKey));if(b.listPermissions&SPG.Permissions.editListItems){var h=a.GetSpCsrRenderCtx();Eb(b.listId,b.selectedTimelineView)&&e.InsertMenuItem(Strings.STS.L_TimelineAddToTimeline,function(){a:;var h=false,e=a.GetSelectedRecordKeys(),f=[];if(e!=null&&e.length&&e.length>0)for(var g=0;g<e.length;g++){var d={};d.id=e[g];f.push(d);if(d.id==c.recordKey)h=true}if(h==false){var d={};d.id=c.recordKey.toString();f=[d]}AddItemsToTimeline(f,b.listId,b.selectedTimelineView)},"/_layouts/15/images/AddTaskToTimeline.png",null,F||a.IsEntryRecordKey(c.recordKey));cb(c.recordKey)&&e.InsertMenuItem(Strings.STS.L_SPGanttDiscardChangesMenuItem,function(){a:;kb(c.recordKey)},null,null,false)}var f=SP.Internal.DomElement.GetLocation(a.parentNode),g=SP.Internal.DomElement.GetEventLocation(c.eventInfo);e.Show({left:g.x-f.x,top:g.y-f.y,width:1,height:1},null)}}function cc(f,g){a:;var b=a.GetHierarchyQueryObject();if(a.IsEntryRecordKey(f)&&g!=null){var h=a.GetLastRecordKey();return h==null?100:b.GetTagObject(a.GetLastRecordKey()).order+g*100}else{var d=b.GetPreviousSibling(f);while(d!=null&&(a.IsEntryRecordKey(d)||a.IsProvisionalRecordKey(d)))d=b.GetPreviousSibling(d);var c=b.GetNextSibling(f);while(c!=null&&(a.IsEntryRecordKey(c)||a.IsProvisionalRecordKey(c)))c=b.GetNextSibling(c);var e;if(d==null&&c==null)e=100;else if(d==null)e=b.GetTagObject(c).order/2;else if(c==null)e=b.GetTagObject(d).order+100;else e=(b.GetTagObject(c).order+b.GetTagObject(d).order)/2;b.SetTagObject(f,{order:e});return e}}function lb(b,c){a:;if(a.IsEntryRecordKey(b))b=a.GetLastRecordKey();if(c==null)c=a.GetHierarchyQueryObject();var d=b==null?0:c.GetParentKey(b);return d==0?null:d}function Kb(a){a:;var c={};for(var b in a)if(typeof a[b]=="number")c[b]=a[b];return c}};SP.GanttControl.Instances=[];SP.GanttControl.FnGanttCreationCallback=[];SP.GanttControl.WaitForGanttCreation=function(c){for(var b=SP.GanttControl.Instances,a=0;a<b.length;a++)c(b[a]);SP.GanttControl.FnGanttCreationCallback.push(c)};SP.JsGrid.SharePointDataSource=function(q,r,n,e,l,j,m){a:;var a=this,d=null,u,t,b,g,c=null,i=false;this.recordFactory;this.tableCache;this.populatingWebMethod=q;this.initWebMethod=r;this.computeDataRangeWebMethod=n;this.RefreshTableView=function(i,d,j){a:;var g=new SP.JsGrid.JsGridControl.TableViewParameters,h=SP.JsGrid.DeserializationMode.TableView;return e[this.initWebMethod.name](f(this.initWebMethod,h),function(f){a:;var e=new SP.JsGrid.Deserializer(f,h,b);c=e.recordKeyHash;if(!i){l.ClearTableView();a.tableCache.Clear()}k(e,g,true);d!=null&&d(g,e.additionalParams)},j)};this.RefreshRowView=function(i,d,j){a:;var g=SP.JsGrid.DeserializationMode.RowView;return e[this.populatingWebMethod.name](f(this.populatingWebMethod,g),function(j){a:;var e=new SP.JsGrid.Deserializer(j,g,b);c=e.recordKeyHash;var f=e.InitJsGridRowViewParams();!i&&a.tableCache.Clear();h(e,f);d!=null&&d(f,e.additionalParams)},j)};this.GetAutoFilterEntries=function(g,d,c){a:;var a=SP.JsGrid.DeserializationMode.AutoFilter;return e[this.populatingWebMethod.name](f(this.populatingWebMethod,a,g),function(e){a:;var c=new SP.JsGrid.Deserializer(e,a,b);d(c.autoFilterEntries)},c)};this.BeginFullLoad=function(j,h,l){a:;var d=SP.JsGrid.DeserializationMode.Full;return e[this.initWebMethod.name](f(this.initWebMethod,d),function(h){a:;var f=new SP.JsGrid.Deserializer(h,d);if(f.minimalInfo!=null)i=true;c=f.recordKeyHash;b=f.keyColumnName;g=f.InitJsGridParams(l);g.tableCache=a.tableCache=new SP.JsGrid.TableCache(s,o,e[a.computeDataRangeWebMethod.name]);a.tableCache.SetConvertAllBlobsToRecords(true);a.tableCache.SetKeepDataInBlobCache(false);a.tableCache.SetMaxRecordCount(1e3);k(f,g.tableViewParams,false);j(g,f.additionalParams)},h)};this.HasColumnName=function(a){a:;return this.recordFactory.gridFieldMap[a]!=null};this.AddColumn=function(a){a:;this.recordFactory.gridFieldMap[a.key]=a;var d={},c=this.tableCache.GetView(),b=function(){a:;return{isProp:true,prop:SP.JsGrid.Property.MakeProperty(undefined,undefined,a.hasDataValue,a.hasLocalizedValue,a.GetPropType())}};for(var e in c)d[c[e]]=b();this.tableCache.AddColumn(a.key,d,b)};function k(c,d,e){a:;e&&c.InitJsGridTableViewParams(d);if(b!=c.keyColumnName)b=c.keyColumnName;a.recordFactory=new SP.JsGrid.RecordFactory(c.gridFieldMap,b);h(c,d.rowViewParams)}function h(b){a:;d!=null&&a.tableCache.ClearRecords(d);a.tableCache.AddRawDataToCache(SP.Internal.JS.ConvertSetKeysToArray(b.data),b.data);d=b.viewDependentKeys;b.InitCellStyles(g.styleManager);m()}function f(g,f,e,b){a:;var d=g.fnGenerateArgs(f),a=d.gridSerializerArgs==null?{}:d.gridSerializerArgs;if(!i){if(a.PagingInfo==null)a.PagingInfo=b!=null?p(b):["FirstVisible:100"]}else if(a.PagingInfo==null)a.PagingInfo=b!=null?{pos:b[0].pos,count:b[0].count}:{pos:0,count:100};a.RequestType=f;if(c!=null)a.RememberedRecordKeyHash=c;if(e!=null)a.AutoFilterColumnKeys=e;d.gridSerializerArgs=a;return d}function o(e,b){a:;var f={};for(var c in b)if(b[c]in e){var d=e[b[c]];f[b[c]]=a.recordFactory.MakeRecord(d.data,d.localized)}return f}function s(k,g){a:;function m(o){a:;var e=new SP.JsGrid.Deserializer(o,SP.JsGrid.DeserializationMode.Slice,b);c=e.recordKeyHash;if(e.recordKeyOrderChanged){e=new SP.JsGrid.Deserializer(o,SP.JsGrid.DeserializationMode.RowView,b);var n=e.InitJsGridRowViewParams();h(e,n);j!=null&&j(n,e.additionalParams)}else if(e.minimalInfo==null)if(e.viewDependentKeys!=null)d=d==null?e.viewDependentKeys:d.concat(e.viewDependentKeys);var m=SP.Internal.JS.ConvertSetKeysToArray(e.data);if(i)for(var f=0;f<m.length;f++){var p=a.tableCache.RecordIdxToKey(k[0].pos+f);l.ChangeKeys(p,m[f])}g([{data:e.data,keys:m}])}return e[a.populatingWebMethod.name](f(a.populatingWebMethod,SP.JsGrid.DeserializationMode.Slice,null,k),m,function(){a:;g(null)})}function p(b){a:;for(var c=[],a=0;a<b.length;a++)c.push(b[a].pos+","+b[a].count);return c}};typeof Sys!="undefined"&&Sys&&Sys.Application&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("spgantt.js");typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkEnd_spgantt.js")}function ULSc2E(){var a={};a.ULSTeamName="Microsoft SharePoint Foundation";a.ULSFileName="spgantt.commentedjs";return a}var g_ganttControlInstances,OnJsGridIframeLoad;$_global_spgantt();